---
## Front matter
title: "Отчёт по лабораторной работе"
subtitle: "Основы работы с Midnight Commander (mc). Структура программы на языке ассемблера NASM. Системные вызовы в ОС GNU Linux"
author: "Поляков Глеб Сергеевич"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: PT Serif
romanfont: PT Serif
sansfont: PT Sans
monofont: PT Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Здесь приводится формулировка цели лабораторной работы. Формулировки
цели для каждой лабораторной работы приведены в методических
указаниях.

Цель данного шаблона --- максимально упростить подготовку отчётов по
лабораторным работам.  Модифицируя данный шаблон, студенты смогут без
труда подготовить отчёт по лабораторным работам, а также познакомиться
с основными возможностями разметки Markdown.

# Задание

Здесь приводится описание задания в соответствии с рекомендациями
методического пособия и выданным вариантом.

# Теоретическое введение

## Основы работы с Midnight Commander

Midnight Commander (или просто mc) — это программа, которая позволяет просматривать структуру каталогов и выполнять основные операции по управ- лению файловой системой, т.е. mc является файловым менеджером. Midnight Commander позволяет сделать работу с файлами более удобной и наглядной.

Рис. 6.1. Окно Midnight Commander

Для активации оболочки Midnight Commander достаточно ввести в командной строке mc и нажать клавишу Enter (рис. 6.1).

В Midnight Commander используются функциональные клавиши F1 — F10 , к которым привязаны часто выполняемые операции (табл. 6.1).
: Функциональные клавиши Midnight Commander {#tbl:std-dir}

| Функциональные клавиши | Выполняемое действие |
|------------|--------------------------------------|
| F1         | Вызов контекстно-зависимой подсказки |
| F2         | вызов меню, созданного пользователем |
| F3         | просмотр файла, на который указывает подсветка в активной панели |
| F4         | вызов встроенного редактора для файла, на который указывает подсветка в активной панели |
| F5         | копирование файла или группы отмеченных файлов из каталога, отображаемого в активной панели, в каталог, отображаемый на второй панели |
| F6         | перенос файла или группы отмеченных файлов из каталога, отображаемого в активной панели, в каталог, отображаемый на второй панели |
| F7         | создание подкаталога в каталоге, отображаемом в активной панели |
| F8         | удаление файла (подкаталога) или группы отмеченных файлов |
| F9         | вызов основного меню программы |
| F10        | выход из программы |

Следующие комбинации клавиш облегчают работу с Midnight Commander:

* Tab используется для переключениями между панелями;
* ↑ и ↓ используется для навигации, Enter для входа в каталог или от- крытия файла (если в файле расширений mc.ext заданы правила связи определённых расширений файлов с инструментами их запуска или обра-
ботки);
* Ctrl + u (или через меню Команда > Переставить панели ) меняет местами
содержимое правой и левой панелей;
* Ctrl + o (или через меню Команда > Отключить панели ) скрывает или воз- вращает панели Midnight Commander, за которыми доступен для работы командный интерпретатор оболочки и выводимая туда информация.
* Ctrl + x + d (или через меню Команда > Сравнить каталоги ) позволяет срав- нить содержимое каталогов, отображаемых на левой и правой панелях.

Дополнительную информацию о Midnight Commander можно получить по команде man mc и на странице проекта[3].

## Структура программы на языке ассемблера NASM
Программа на языке ассемблера NASM, как правило, состоит из трёх секций: секция кода программы (SECTION .text), секция инициированных (известных во время компиляции) данных (SECTION .data) и секция неинициализированных данных (тех, под которые во время компиляции только отводится память, а значение присваивается в ходе выполнения программы)(SECTION .bss).
Таким образом, общая структура программы имеет следующий вид:
	
	SECTION .data ...
	SECTION .bss ...
	SECTION .text GLOBAL _start _start:
	...
	 ; Секция содержит переменные, для
	 ; которых задано начальное значение
	 ; Секция содержит переменные, для
	 ; которых не задано начальное значение
	 ; Секция содержит код программы
	; Точка входа в программу
	; Текст программы
	mov  eax,1   ; Системный вызов для выхода (sys_exit)
	mov  ebx,0   ; Выход с кодом возврата 0 (без ошибок)
	int  80h     ; Вызов ядра

Для объявления инициированных данных в секции .data используются ди- рективы DB, DW, DD, DQ и DT, которые резервируют память и указывают, какие значения должны храниться в этой памяти:

* DB (define byte) — определяет переменную размером в 1 байт;
* DW (define word) — определяет переменную размеров в 2 байта (слово);
* DD (define double word) — определяет переменную размером в 4 байта
(двойное слово);
* DQ(definequadword)—определяет переменную размером в 8 байт (учетверённое слово);
* DT (define ten bytes) — определяет переменную размером в 10 байт.

Директивы используются для объявления простых переменных и для объявления массивов. Для определения строк принято использовать директиву DB в связи с особенностями хранения данных в оперативной памяти. 
Синтаксис директив определения данных следующий:

| Пример | Пояснение |
|------------|--------------------------------------|
| a db 10011001b | Определяем переменную a размером 1 байт с начальным значением, заданным в двоичной системе счисления (на двоичную систему счисления указывает также буква b (binary) в конце числа) |
| b db '!' | Определяем переменную b в 1 байт, инициализируемую символом! |
| c db "Hello" | Определяем строку из 5 байт |
| d dd -345d | Определяем переменную d размером 4 байт а с начальным значением, заданным в десятичной системе счисления (на десятичную систему указывает буква d (decimal) в конце числа)|
| h dd 0f1ah | определяем переменную h размером 4 байта с начальным значением, заданным в шестнадцатеричной системе счисления (h — hexadecimal) |

<имя> DB <операнд> [, <операнд>] [, <операнд>]
Таблица 6.2. Примеры Пример
a db 10011001b
b db '!'
Пояснение
определяем переменную a размером 1 байт с начальным значением, заданным в двоичной системе счисления (на двоичную систему счисления указывает также буква b (binary) в конце числа)
определяем переменную b в 1 байт, инициализируемую символом !

Для объявления неинициированных данных в секции .bss используются директивы resb, resw, resd и другие, которые сообщают ассемблеру, что необходимо зарезервировать заданное количество ячеек памяти. Примеры их использования приведены в табл. 6.3.
Таблица 6.3. Директивы для объявления неинициированных данных

| Директива | Назначение дирекивы | Аргумент | Назначение аргумента |
|------------|--------------|-----|-----------------|
| resb | Резервирование заданного числа однобайтовых ячеек | string resb 20 | По адресу с меткой string будет расположен массив из 20 однобайтовых ячеек (хранение строки символов) |
| resw | Резервирование заданного числа двухбайтовых ячеек (слов) | count resw 256 | По адресу с меткой count будет расположен массив из 256 двухбайтовых слов |
| resd | Резервирование заданного числа четырёхбайтовых ячеек (двойных слов) | x resd 1 | По адресу с меткой x будет расположено одно двойное слово (т.е. 4 байта для хранения большого числа) |

## Элементы программирования 
### Описание инструкции mov
Инструкция языка ассемблера mov предназначена для дублирования данных источника в приёмнике. В общем виде эта инструкция записывается в виде
mov dst,src
Здесь операнд dst — приёмник, а src — источник.
В качестве операнда могут выступать регистры (register), ячейки памяти (memory) и непосредственные значения (const). В табл. 6.4 приведены вари- анты использования mov с разными операндами.
Таблица 6.4. Варианты использования mov с разными операндами

| Тип операндов | Пример | Пояснение |
|---------------|--------|-----------|
| mov <reg>,<reg> | mov eax,ebx | пересылает значение регистра ebx в регистр eax пересылает в регистр cx значение из памяти, указанной в eax |
| mov <reg>,<mem> | mov cx,[eax] | пересылает в регистр cx значение из памяти, указанной в eax |
| mov <mem>,<reg> | mov rez,ebx | пересылает в переменную rez значение из регистра ebx |
| mov <reg>,<const> | mov eax,403045h | пишет в регистр eax значение 403045h |
| mov <reg>,<const> | mov byte[rez],0 | записываетв переменную rez значение 0 |

ВАЖНО! Переслать значение из одной ячейки памяти в другую нельзя, для этого необходимо использовать две инструкции mov:

	mov   eax, x
	mov   y, eax

Также необходимо учитывать то, что размер операндов приемника и источни- ка должны совпадать. Использование слудующих примеров приведет к ошибке:

* mov al,1000h—ошибка, попытка записать 2-байтное число в 1-байтный регистр;
* mov eax,cx — ошибка, размеры операндов не совпадают. 

### Описание инструкции int
Инструкция языка ассемблера intпредназначена для вызова прерывания с указанным номером. В общем виде она записывается в виде

	int n

Здесь n — номер прерывания, принадлежащий диапазону 0–255.
При программировании в Linux с использованием вызовов ядра sys_calls n=80h (принято задавать в шестнадцатеричной системе счисления).
После вызова инструкции int 80h выполняется системный вызов какой-либо функции ядра Linux. При этом происходит передача управления ядру операционной системы. Чтобы узнать, какую именно системную функцию нужно выполнить, ядро извлекает номер системного вызова из регистра eax. Поэтому перед вызовом прерывания необходимо поместить в этот регистр нужный номер. Кроме того, многим системным функциям требуется передавать какие-либо параметры. По принятым в ОС Linux правилам эти параметры помещаются в порядке следования в остальные регистры процессора: ebx, ecx, edx. Если системная функция должна вернуть значение, то она помещает его в регистр eax.

### Системные вызовы для обеспечения диалога с пользователем

Простейший диалог с пользователем требует наличия двух функций — вывода текста на экран и ввода текста с клавиатуры. Простейший способ вывести строку на экран — использовать системный вызов write. Этот системный вызов имеет номер 4, поэтому перед вызовом инструкции int необходимо поместить значение 4 в регистр eax. Первым аргументом write, помещаемым в регистр ebx, задаётся дескриптор файла. Для вывода на экран в качестве дескриптора файла нужно указать 1 (это означает «стандартный вывод», т. е. вывод на экран). Вторым аргументом задаётся адрес выводимой строки (помещаем его в регистр ecx,например,инструкциейmov ecx, msg).Строкаможетиметьлюбуюдлину. Последним аргументом (т.е. в регистре edx) должна задаваться максимальная длина выводимой строки.

Для ввода строки с клавиатуры можно использовать аналогичный системный вызов read. Его аргументы – такие же, как у вызова write, только для «чтения» с клавиатуры используется файловый дескриптор 0 (стандартный ввод).

Системный вызов exit является обязательным в конце любой программы на языке ассемблер. Для обозначения конца программы перед вызовом инструк- цииint 80hнеобходимопоместитьврегистреахзначение1,аврегистрebx код завершения 0.

Например, в табл. [-@tbl:std-dir] приведено краткое описание стандартных каталогов Unix.

: Описание некоторых каталогов файловой системы GNU Linux {#tbl:std-dir}

| Имя каталога | Описание каталога                                                                                                          |
|--------------|----------------------------------------------------------------------------------------------------------------------------|
| `/`          | Корневая директория, содержащая всю файловую                                                                               |
| `/bin `      | Основные системные утилиты, необходимые как в однопользовательском режиме, так и при обычной работе всем пользователям     |
| `/etc`       | Общесистемные конфигурационные файлы и файлы конфигурации установленных программ                                           |
| `/home`      | Содержит домашние директории пользователей, которые, в свою очередь, содержат персональные настройки и данные пользователя |
| `/media`     | Точки монтирования для сменных носителей                                                                                   |
| `/root`      | Домашняя директория пользователя  `root`                                                                                   |
| `/tmp`       | Временные файлы                                                                                                            |
| `/usr`       | Вторичная иерархия для данных пользователя                                                                                 |

Более подробно об Unix см. в [@gnu-doc:bash;@newham:2005:bash;@zarrelli:2017:bash;@robbins:2013:bash;@tannenbaum:arch-pc:ru;@tannenbaum:modern-os:ru].

# Выполнение лабораторной работы

Описываются проведённые действия, в качестве иллюстрации даётся ссылка на иллюстрацию (рис. [-@fig:001])

![Название рисунка](image/placeimg_800_600_tech.jpg){ #fig:001 width=70% }

# Выводы

Здесь кратко описываются итоги проделанной работы.

# Список литературы{.unnumbered}

::: {#refs}
:::
